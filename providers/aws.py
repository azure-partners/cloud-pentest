import requests
import ipaddress
from termcolor import cprint

def discovery_aws():
    data = requests.get('https://ip-ranges.amazonaws.com/ip-ranges.json').json()['prefixes']
    return {ipaddress.ip_network(ip['ip_prefix']): f"{ip['service'].lower()}.{ip['region'].lower()}" for ip in data}

def get_aws_networks(verbose=True):
    print_dbg = lambda *x: cprint(*x) if verbose else None
    
    print_dbg(f"[-] Exporting Amazon Whitelists", 'blue')
    networks = discovery_aws()
    print_dbg(f"Amazon Whitelist was exported", 'green')
    return networks