import requests
from termcolor import cprint
import ipaddress

def discovery_google():
   data = requests.get('https://www.gstatic.com/ipranges/goog.json').json()['prefixes']
   return {ipaddress.ip_network(list(ip.values())[0]): 'Google' for ip in data}

def discovery_gcp():
   data = requests.get('https://www.gstatic.com/ipranges/cloud.json').json()['prefixes']
   return {ipaddress.ip_network(list(ip.values())[0]): f"{ip['service'].replace(' ','')}.{ip['scope']}" for ip in data}

def get_gcp_networks(verbose=True):
   print_dbg = lambda *x: cprint(*x) if verbose else None

   print_dbg(f"[-] Exporting Google Whitelists", 'blue')
   networks = discovery_google()
   print_dbg(f"Google Whitelist was exported", 'green')
   networks |= discovery_gcp()
   print_dbg(f"GCP Whitelist was exported", 'green')
   return networks